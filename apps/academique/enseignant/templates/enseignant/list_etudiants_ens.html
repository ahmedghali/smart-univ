{% extends 'enseignant/base_Ens.html' %}
{% load static %}

{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{# LISTE DES Ã‰TUDIANTS                                                              #}
{# HÃ©rite de base_Ens.html - active_menu = 'etudiants'                             #}
{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}

{% block content_ens %}
<div class="grey_zone m-1 p-2">
    <!-- EN-TÃŠTE -->
    <h4 class="border-bottom border-danger text-dark mb-3">
        <i class="fas fa-user-graduate"></i>
        Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø© - {{my_Dep.nom_ar}}
    </h4>

    <!-- FORMULAIRE DE FILTRAGE -->
    <div class="p-2 mb-2">
        <form id="etudiants_form" method="POST" class="filter-form">
            {% csrf_token %}

            <div class="mb-2 d-flex align-items-center flex-wrap gap-2" id="div_refs">
                <label class="myLabelList me-2">Ø§Ù„Ø¥ØµÙ„Ø§Ø­:</label>
                <select id="refs" name="reforme" class="form-select w-auto">
                    <option value="" disabled selected>-----Ø¥Ø®ØªØ± Ø§Ù„Ø¥ØµÙ„Ø§Ø­------</option>
                </select>
            </div>

            <div class="mb-2 d-flex align-items-center flex-wrap gap-2" id="div_nivs">
                <label class="myLabelList me-2">Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</label>
                <select id="nivs" name="niveau" class="form-select w-auto" disabled>
                    <option value="" disabled selected>-----Ø¥Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰-----</option>
                </select>
            </div>

            <div class="mb-2 d-flex align-items-center flex-wrap gap-2" id="div_groupes">
                <label class="myLabelList me-2">Ø§Ù„ÙÙˆØ¬ / Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:</label>
                <select id="groupes" name="niv_spe_dep_sg" class="form-select w-auto" disabled>
                    <option value="" disabled selected>-----Ø¥Ø®ØªØ± Ø§Ù„ÙÙˆØ¬-----</option>
                </select>
            </div>

            <!-- Boutons d'action -->
            <div class="mt-3 d-flex gap-2 flex-wrap">
                <button type="button" id="btn_afficher" class="btn btn-success" disabled>
                    <i class="fas fa-list"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø©
                </button>
                <a href="{% url 'ense:timeTable_Ens' my_Dep.id %}" class="btn btn-secondary">
                    <i class="fas fa-calendar"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø¥Ø³ØªØ¹Ù…Ø§Ù„ Ø§Ù„Ø²Ù…Ù†
                </a>
                <a href="{% url 'ense:list_matieres_ens' my_Dep.id %}" class="btn btn-outline-info">
                    <i class="fas fa-book"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¯
                </a>
            </div>
        </form>
    </div>

    <!-- Messages de statut -->
    <div id="status_messages" class="mt-3"></div>

    <!-- Loading spinner -->
    <div id="loading_spinner" class="loading-spinner">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
        </div>
        <p class="mt-2 text-muted">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
    </div>

    <!-- Statistiques -->
    <div id="stats_section" class="mt-3" style="display: none;">
        <div class="row g-2 mb-3">
            <div class="col-md-4">
                <div class="card bg-primary text-white text-center p-2">
                    <h4 id="total_count" class="mb-0">0</h4>
                    <small>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø©</small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-success text-white text-center p-2">
                    <h4 id="inscrit_count" class="mb-0">0</h4>
                    <small>Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-warning text-dark text-center p-2">
                    <h4 id="non_inscrit_count" class="mb-0">0</h4>
                    <small>ØºÙŠØ± Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Zone d'affichage du tableau des Ã©tudiants -->
    <div id="etudiants_table" class="mt-3"></div>
</div>
{% endblock %}

{% block extra_css_ens %}
<style>
    .sortable {
        cursor: pointer;
        user-select: none;
        transition: background-color 0.2s;
    }
    .sortable:hover {
        background-color: #495057 !important;
    }
    .sortable i.fa-sort,
    .sortable i.fa-sort-up,
    .sortable i.fa-sort-down {
        margin-left: 5px;
        font-size: 0.85em;
    }
</style>
{% endblock %}

{% block extra_js_ens %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // VÃ©rification des Ã©lÃ©ments requis
    const csrfInput = document.querySelector('[name=csrfmiddlewaretoken]');
    if (!csrfInput) {
        console.error('CSRF token non trouvÃ©');
        return;
    }

    const etudiantsJsonUrl = "{% url 'ense:etudiants_json_ens' my_Dep.id %}";
    const etudiantsListUrl = "{% url 'ense:list_etudiants_ens' my_Dep.id %}";
    const csrfToken = csrfInput.value;

    const refsSelect = document.getElementById('refs');
    const nivsSelect = document.getElementById('nivs');
    const groupesSelect = document.getElementById('groupes');
    const btnAfficher = document.getElementById('btn_afficher');
    const etudiantsTable = document.getElementById('etudiants_table');
    const statusMessages = document.getElementById('status_messages');
    const loadingSpinner = document.getElementById('loading_spinner');
    const statsSection = document.getElementById('stats_section');

    // VÃ©rification que tous les Ã©lÃ©ments existent
    if (!refsSelect || !nivsSelect || !groupesSelect) {
        console.error('Ã‰lÃ©ments de formulaire non trouvÃ©s');
        return;
    }

    // Charger les donnÃ©es initiales
    loadReformes();

    // Ã‰vÃ©nement: changement de rÃ©forme
    refsSelect.addEventListener('change', function() {
        nivsSelect.disabled = !this.value;
        groupesSelect.disabled = true;
        btnAfficher.disabled = true;
        resetSelect(nivsSelect, '-----Ø¥Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰-----');
        resetSelect(groupesSelect, '-----Ø¥Ø®ØªØ± Ø§Ù„ÙÙˆØ¬-----');
        hideResults();
        if (this.value) loadNiveaux(this.value);
    });

    // Ã‰vÃ©nement: changement de niveau
    nivsSelect.addEventListener('change', function() {
        groupesSelect.disabled = !this.value;
        btnAfficher.disabled = true;
        resetSelect(groupesSelect, '-----Ø¥Ø®ØªØ± Ø§Ù„ÙÙˆØ¬-----');
        hideResults();
        if (this.value) loadGroupes(refsSelect.value, this.value);
    });

    // Ã‰vÃ©nement: changement de groupe
    groupesSelect.addEventListener('change', function() {
        btnAfficher.disabled = !this.value;
    });

    // Ã‰vÃ©nement: clic sur le bouton afficher
    btnAfficher.addEventListener('click', loadEtudiants);

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FONCTIONS UTILITAIRES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function resetSelect(select, placeholder) {
        select.innerHTML = `<option value="" disabled selected>${placeholder}</option>`;
    }

    function showLoading() { loadingSpinner.classList.add('show'); }
    function hideLoading() { loadingSpinner.classList.remove('show'); }

    function hideResults() {
        etudiantsTable.innerHTML = '';
        statsSection.style.display = 'none';
    }

    function showMessage(message, type = 'info') {
        statusMessages.innerHTML = `
            <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                <i class="fas fa-${type === 'danger' ? 'exclamation-circle' : 'info-circle'}"></i> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>`;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CHARGEMENT DES RÃ‰FORMES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function loadReformes() {
        console.log('Chargement des rÃ©formes...');
        fetch(etudiantsJsonUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded', 'X-CSRFToken': csrfToken },
            body: 'action=get_reformes'
        })
        .then(r => {
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            return r.json();
        })
        .then(data => {
            console.log('RÃ©formes reÃ§ues:', data);
            if (data.data && data.data.length > 0) {
                data.data.forEach(item => {
                    const opt = document.createElement('option');
                    opt.value = item.id;
                    opt.textContent = item.nom_ar || item.nom_fr || item.code;
                    refsSelect.appendChild(opt);
                });
            } else {
                showMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥ØµÙ„Ø§Ø­Ø§Øª Ù…ØªØ§Ø­Ø©', 'warning');
            }
        })
        .catch(err => { console.error('Erreur:', err); showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª', 'danger'); });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CHARGEMENT DES NIVEAUX
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function loadNiveaux(reformeId) {
        console.log('Chargement des niveaux pour rÃ©forme:', reformeId);
        fetch(etudiantsJsonUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded', 'X-CSRFToken': csrfToken },
            body: `action=get_niveaux&reforme=${reformeId}`
        })
        .then(r => {
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            return r.json();
        })
        .then(data => {
            console.log('Niveaux reÃ§us:', data);
            if (data.data && data.data.length > 0) {
                data.data.forEach(item => {
                    const opt = document.createElement('option');
                    opt.value = item.id;
                    opt.textContent = item.nom_ar || item.nom_fr || item.code;
                    nivsSelect.appendChild(opt);
                });
            }
        })
        .catch(err => { console.error('Erreur:', err); showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª', 'danger'); });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CHARGEMENT DES GROUPES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function loadGroupes(reformeId, niveauId) {
        console.log('Chargement des groupes pour niveau:', niveauId);
        fetch(etudiantsJsonUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded', 'X-CSRFToken': csrfToken },
            body: `action=get_groupes&reforme=${reformeId}&niveau=${niveauId}`
        })
        .then(r => {
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            return r.json();
        })
        .then(data => {
            console.log('Groupes reÃ§us:', data);
            if (data.data && data.data.length > 0) {
                // Option pour tous les Ã©tudiants du niveau
                const optTous = document.createElement('option');
                optTous.value = `tous_${niveauId}_${reformeId}`;
                optTous.textContent = 'ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø¨Ø© Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆÙ‰';
                groupesSelect.appendChild(optTous);

                // Grouper par section
                const sections = {};
                data.data.forEach(item => {
                    const sectionName = item.section_nom || 'Ø¨Ø¯ÙˆÙ† Ù‚Ø·Ø§Ø¹';
                    if (!sections[sectionName]) {
                        sections[sectionName] = [];
                    }
                    sections[sectionName].push(item);
                });

                // Afficher les sections et groupes
                Object.keys(sections).forEach(sectionName => {
                    const groups = sections[sectionName];

                    // Optgroup pour la section
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = `â”€â”€ ${sectionName} â”€â”€`;

                    // Groupes individuels (incluant les section containers du backend)
                    groups.forEach(item => {
                        const opt = document.createElement('option');
                        opt.value = item.id;
                        const displayName = item.groupe_nom || item.section_nom || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                        const studentCount = item.nbr_etudiants || 0;
                        opt.textContent = `${displayName} (${studentCount} Ø·Ø§Ù„Ø¨)`;
                        optgroup.appendChild(opt);
                    });

                    groupesSelect.appendChild(optgroup);
                });
            } else {
                showMessage('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙÙˆØ§Ø¬ Ù…ØªØ§Ø­Ø©', 'warning');
            }
        })
        .catch(err => { console.error('Erreur:', err); showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙÙˆØ§Ø¬', 'danger'); });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CHARGEMENT DES Ã‰TUDIANTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function loadEtudiants() {
        const groupeId = groupesSelect.value;
        if (!groupeId) return;

        showLoading();
        statusMessages.innerHTML = '';
        hideResults();

        console.log('Chargement des Ã©tudiants pour groupe:', groupeId);
        fetch(etudiantsListUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded', 'X-CSRFToken': csrfToken },
            body: `niv_spe_dep_sg=${groupeId}`
        })
        .then(r => {
            if (!r.ok) throw new Error(`HTTP ${r.status}`);
            return r.json();
        })
        .then(data => {
            hideLoading();
            console.log('Ã‰tudiants reÃ§us:', data);
            if (data.error) { showMessage(data.error, 'danger'); return; }
            if (!data.data || data.data.length === 0) {
                etudiantsTable.innerHTML = `<div class="alert alert-warning text-center"><i class="fas fa-exclamation-triangle fa-2x mb-2"></i><p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø© Ù„Ù„Ø¹Ø±Ø¶</p></div>`;
                return;
            }
            renderEtudiantsTable(data.data);
        })
        .catch(err => { hideLoading(); console.error('Erreur:', err); showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø©', 'danger'); });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // AFFICHAGE DU TABLEAU
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function renderEtudiantsTable(etudiants) {
        // Calculer les statistiques
        const totalCount = etudiants.length;
        const inscritCount = etudiants.filter(e => e.est_inscrit === true).length;
        const nonInscritCount = totalCount - inscritCount;

        // Afficher les statistiques
        document.getElementById('total_count').textContent = totalCount;
        document.getElementById('inscrit_count').textContent = inscritCount;
        document.getElementById('non_inscrit_count').textContent = nonInscritCount;
        statsSection.style.display = 'block';

        // Nom du groupe sÃ©lectionnÃ©
        const selectedText = groupesSelect.options[groupesSelect.selectedIndex].textContent;

        // Stocker les donnÃ©es pour le tri
        window.currentEtudiants = etudiants;
        window.currentSortField = null;
        window.currentSortOrder = 'asc';

        renderTable(etudiants, selectedText);
    }

    // Fonction de tri
    function sortEtudiants(field) {
        if (window.currentSortField === field) {
            window.currentSortOrder = window.currentSortOrder === 'asc' ? 'desc' : 'asc';
        } else {
            window.currentSortField = field;
            window.currentSortOrder = 'asc';
        }

        const sorted = [...window.currentEtudiants].sort((a, b) => {
            const valA = (a[field] || '').toLowerCase();
            const valB = (b[field] || '').toLowerCase();
            if (valA < valB) return window.currentSortOrder === 'asc' ? -1 : 1;
            if (valA > valB) return window.currentSortOrder === 'asc' ? 1 : -1;
            return 0;
        });

        const selectedText = groupesSelect.options[groupesSelect.selectedIndex].textContent;
        renderTable(sorted, selectedText);
    }

    // Rendre globale pour les onclick
    window.sortEtudiants = sortEtudiants;

    function getSortIcon(field) {
        if (window.currentSortField !== field) return '<i class="fas fa-sort text-muted"></i>';
        return window.currentSortOrder === 'asc'
            ? '<i class="fas fa-sort-up"></i>'
            : '<i class="fas fa-sort-down"></i>';
    }

    function renderTable(etudiants, selectedText) {
        let html = `
            <div class="card fade-in">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0"><i class="fas fa-users"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø© - ${selectedText} (${etudiants.length} Ø·Ø§Ù„Ø¨)</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-sm align-middle mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th class="text-center" style="width: 50px;">#</th>
                                    <th class="sortable" onclick="sortEtudiants('nom_fr')" style="cursor: pointer;">
                                        Nom ${getSortIcon('nom_fr')}
                                    </th>
                                    <th class="sortable" onclick="sortEtudiants('prenom_fr')" style="cursor: pointer;">
                                        PrÃ©nom ${getSortIcon('prenom_fr')}
                                    </th>
                                    <th class="sortable" onclick="sortEtudiants('nom_ar')" style="cursor: pointer;">
                                        <i class="fas fa-user"></i> Ø§Ù„Ù„Ù‚Ø¨ ${getSortIcon('nom_ar')}
                                    </th>
                                    <th class="sortable" onclick="sortEtudiants('prenom_ar')" style="cursor: pointer;">
                                        Ø§Ù„Ø¥Ø³Ù… ${getSortIcon('prenom_ar')}
                                    </th>
                                    <th class="text-center"><i class="fas fa-id-card"></i> Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                                    <th class="text-center"><i class="fas fa-layer-group"></i> Ø§Ù„Ù‚Ø·Ø§Ø¹</th>
                                    <th class="text-center"><i class="fas fa-users"></i> Ø§Ù„ÙÙˆØ¬</th>
                                    <th class="text-center"><i class="fas fa-phone"></i> Ø§Ù„Ù‡Ø§ØªÙ</th>
                                    <th class="text-center"><i class="fas fa-envelope"></i> Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ù‡Ù†ÙŠ</th>
                                    <th class="text-center"><i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</th>
                                    <th class="text-center"><i class="fas fa-check-circle"></i> Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                </tr>
                            </thead>
                            <tbody>`;

        etudiants.forEach((etudiant, i) => {
            const inscritBadge = etudiant.est_inscrit
                ? '<span class="badge bg-success"><i class="fas fa-check"></i> Ù…Ø³Ø¬Ù„</span>'
                : '<span class="badge bg-warning text-dark"><i class="fas fa-clock"></i> ØºÙŠØ± Ù…Ø³Ø¬Ù„</span>';

            html += `
                <tr>
                    <td class="text-center"><span class="badge bg-primary">${i + 1}</span></td>
                    <td>${etudiant.nom_fr || '-'}</td>
                    <td>${etudiant.prenom_fr || '-'}</td>
                    <td><strong>${etudiant.nom_ar || '-'}</strong></td>
                    <td><strong>${etudiant.prenom_ar || '-'}</strong></td>
                    <td class="text-center"><code>${etudiant.matricule || '-'}</code></td>
                    <td class="text-center">${etudiant.section_nom || '-'}</td>
                    <td class="text-center">${etudiant.groupe_nom || '-'}</td>
                    <td class="text-center">${etudiant.tel_mobile1 || '-'}</td>
                    <td class="text-center"><small>${etudiant.email_prof || '-'}</small></td>
                    <td class="text-center">${etudiant.date_nais || '-'}</td>
                    <td class="text-center">${inscritBadge}</td>
                </tr>`;
        });

        html += `</tbody></table></div></div></div>`;
        etudiantsTable.innerHTML = html;
    }
});
</script>
{% endblock %}
